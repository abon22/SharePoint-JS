<script type="text/javascript" src="/SiteAssets/Scripts/jquery.min.js"></script><script src="/SiteAssets/sputility.min.js"></script><script type="text/javascript" src="/SiteAssets/Scripts/jquery.timeago.js"></script><script type="text/javascript" src="_layouts/15/sp.runtime.js"></script>
<script type="text/javascript" src="_layouts/15/sp.js"></script></script>
<!DOCTYPE html>
<html>
<head>

<meta name="layout" />

      <!--Import Google Icon Font-->
      <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
      <!--Import materialize.css-->
      <link type="text/css" rel="stylesheet" href="https://intranet.houseofit.com.au/SiteAssets/Logo/MaterialDesign/css/materialize.css"  media="screen,projection"/>

      <!-- SEMANTIC UI -->
      <link href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.3.1/semantic.min.css" rel="stylesheet" type="text/css" />

      <!-- SWEET ALERT -->
      <link href="https://intranet.houseofit.com.au/SiteAssets/Logo/MaterialDesign/SweetAlert2/sweetalert2.css" rel="stylesheet"/>

      <link href="https://intranet.houseofit.com.au/SiteAssets/Logo/MaterialDesign/SweetAlert2/animate.css" rel="stylesheet">


<style type="text/css">

  .AlignButtonRight{
  float: right;
}

  .AlignButtonLeft{
  float: left;
}

.ModalTopDistance{
  top:2% !important;
}

i.icon-blue {
    color: #03a9f4;
}

.myChartDiv {
  max-height: 540px;
}

#sideNavBox {
display: none;
}
#contentBox {
margin-left: 20px;
}
.ms-fullscreenmode #contentBox
{
    margin-left: 0;
}

.CenterTextInSpan {
  text-align: center !important;
}

.spancenter {
    display: flex;
    justify-content: center;
    align-items: center;
}

.TrainingHeight { height:auto !important; }

</style>

 <script type="text/javascript">

  $(document).ready(function() {

$('input').keypress(function(event) {
    if (event.keyCode == 13) {
        event.preventDefault();
    }
});

 var userid= _spPageContextInfo.userId;
  var requestUri = _spPageContextInfo.webAbsoluteUrl + "/_api/web/getuserbyid(" + userid + ")";
  var requestHeaders = { "accept" : "application/json;odata=verbose" };
  $.ajax({
    url : requestUri,
    contentType : "application/json;odata=verbose",
    headers : requestHeaders,
    success : onSuccess,
    error : onError
  });


    // setTimeout('window.location.reload();', 120000);

  $('select').material_select();
  $('.collapsible').collapsible();
  $('.tooltipped').tooltip({delay: 30});
  $('.modal').modal();
  $('.tabs').tabs();
  // $(".button-collapse").sideNav();


 $('.timepicker').pickatime({
    default: 'now', // Set default time
    fromnow: 0,       // set default time to * milliseconds from now (using with default = 'now')
    twelvehour: true, // Use AM/PM or 24-hour format
    donetext: 'OK', // text for done-button
    cleartext: 'Clear', // text for clear-button
    canceltext: 'Cancel', // Text for cancel-button
    autoclose: true, // automatic close timepicker
    ampmclickable: true, // make AM PM clickable
    aftershow: function(){} //Function for after opening timepicker
  });

   $('.datepicker').pickadate({
    selectMonths: true, // Creates a dropdown to control month
    selectYears: 100, // Creates a dropdown of 15 years to control year,
    today: 'Today',
    clear: 'Clear',
    close: 'Ok',
    closeOnSelect: true,
    format: 'mm/dd/yyyy',
  });

  $('.button-collapse').sideNav({
      menuWidth: 600, // Default is 240
      edge: 'right', // Choose the horizontal origin
      closeOnClick: true// Closes side-nav on <a> clicks, useful for Angular/Meteor
    }
  );


  $('.dropdown-button').dropdown({
      inDuration: 300,
      outDuration: 225,
      constrainWidth: false, // Does not change width of dropdown to that of the activator
      hover: false, // Activate on hover
      gutter: 0, // Spacing from edge
      belowOrigin: false, // Displays dropdown below the button
      alignment: 'right', // Displays dropdown with edge aligned to the left of button
      stopPropagation: false // Stops event propagation
    }
  );


document.getElementById("ctl00_PlaceHolderSearchArea_SmallSearchInputBox1_csr_sboxdiv").remove();
document.getElementById("DeltaPlaceHolderPageTitleInTitleArea").style.display = "none";
// ExecuteOrDelayUntilScriptLoaded(checkuserprofile,'sp.js');


//---------------------------------------------------------------------------------------------------

  $('#ModalNewEntry').modal({
      dismissible: false, // Modal can be dismissed by clicking outside of the modal
      opacity: .5, // Opacity of modal background
      inDuration: 300, // Transition in duration
      outDuration: 200, // Transition out duration
      startingTop: '15%', // Starting top style attribute
      endingTop: '10%', // Ending top style attribute
      ready: function(modal, trigger) { // Callback for Modal open. Modal and trigger parameters available.
         $('select').material_select();
        
      },
      complete: function() { } // Callback for Modal close
    }
  );

  $('#ModalPoints').modal({
      dismissible: false, // Modal can be dismissed by clicking outside of the modal
      opacity: .5, // Opacity of modal background
      inDuration: 300, // Transition in duration
      outDuration: 200, // Transition out duration
      startingTop: '0%', // Starting top style attribute
      endingTop: '5%', // Ending top style attribute
      ready: function(modal, trigger) { // Callback for Modal open. Modal and trigger parameters available.
         $('select').material_select();
        
      },
      complete: function() { } // Callback for Modal close
    }
  );


var months = [ "January", "February", "March", "April", "May", "June",
      "July", "August", "September", "October", "November", "December" ];



//-------------------------------------------------------------------------------------------


// ExecuteOrDelayUntilScriptLoaded(Load_EmployeeNames,'sp.js');
// ExecuteOrDelayUntilScriptLoaded(Get_Training, "sp.js");

// document.getElementById("Div_IT_Trainings").style.display = "none";

ExecuteOrDelayUntilScriptLoaded(Get_Departments,'sp.js');
ExecuteOrDelayUntilScriptLoaded(Load_All_Employees,'sp.js');
ExecuteOrDelayUntilScriptLoaded(Get_Activities,'sp.js');

document.getElementById("Div_EmployeeNames").style.display = "none";
document.getElementById("Div_Activities").classList.add("s12");


  document.addEventListener('readystatechange', function() {
    if (document.readyState === 'complete') {
      LightTableFilter.init();
    }
  });

  document.addEventListener('readystatechange', function() {
    if (document.readyState === 'complete') {
      TableFilter_EmployeePoints.init();
    }
  });

  document.addEventListener('readystatechange', function() {
    if (document.readyState === 'complete') {
      TableFilter_ActivitiesTable.init();
    }
  });


ExecuteOrDelayUntilScriptLoaded(GetCurrentUsername, "sp.js");

document.getElementById("Div_Activities").style.display = "none";
document.getElementById("Div_EmployeeView").style.display = "none";



}); //---------------------------------------END OF DOCUMENT READY FUNCTION----------------------------------------------------------

  function onSuccess(data, request){

    var loginName = data.d.Title;
    // alert(loginName);

    swal({
      type: 'success',
      title: 'Loading L&N Activities',
      showConfirmButton: false,
      timer: 1000
    });

    if(loginName != "Fernando Durano Singson Jr." && loginName != "Lito Abon Jr." && loginName != "Alfie John Ortiz"  && loginName != "Victor Surita" && loginName != "Dianna Rose Gabayan" && loginName != "Nino Rey Cresencio" && loginName != "Jeanne Mamalo" && loginName != "Artem Soukhomlinov" && loginName != "Mithi Sandalo" && loginName != "Mithi Juacel Sandalo" && loginName != "Nowmar Calidro" && loginName != "Alaiza Grace Pasiolan" && loginName != "Lyra Mae Togonon"){
      // document.getElementById("Div_Activities").style.display = "none";
      document.getElementById("Div_EmployeeView").style.display = "block";
      document.getElementById("Btn_AddActivity").style.display = "none";
    }
    else{
      // document.getElementById("Div_EmployeeView").style.display = "none";
      document.getElementById("Div_Activities").style.display = "block";


    }
  }

  function onError(error) {
    alert("error");
  }


// --------------------------------------------------------------------------------------------------------------
// GET DEPARTMENTS

var Department_List_Items;
var Array_Department = [];

function Get_Departments(){
  context = SP.ClientContext.get_current();
  var Departments = context.get_web().get_lists().getByTitle("Department");
  var camlQuery_Department = SP.CamlQuery.createAllItemsQuery();
  this.Department_List_Items = Departments.getItems(camlQuery_Department);

  context.load(Department_List_Items);
  context.executeQueryAsync(Get_Departments_Succeeded, onQueryFailed);
}
function Get_Departments_Succeeded(){
    var listItemsCollection = Department_List_Items.getEnumerator();

    while (listItemsCollection.moveNext()) {
      var listItem = listItemsCollection.get_current();
        Array_Department.push(listItem.get_item('Title'));

      $("#UL_DropdownDepartment").append(
        "<li class='collection-item'>"+
        "<a onclick='Department_Clicked(this)' style='text-decoration: none' id='"+listItem.get_item('Title')+"'>"+listItem.get_item('Title')+"</a>"+
        "</li>" 
      );

    }

}

function Department_Clicked(a){

  Selected_Department = a.id;

  Employee_Name = [];
  Employee_ID = [];

  document.getElementById("Div_SelectedDepartment").innerText = Selected_Department;  
  ExecuteOrDelayUntilScriptLoaded(Load_Employees_Per_Department,'sp.js');

                      Selected_Employee_Name = [];
                      Selected_Employee_ID = [];
                      Selected_Employee_Username = [];

// if(a.id == "ALL DEPARTMENTS"){
// ExecuteOrDelayUntilScriptLoaded(Load_All_Employees,'sp.js');
// }
// else{
//   Selected_Department = a.id;

//   Employee_Name = [];
//   Employee_ID = [];

//   document.getElementById("Div_SelectedDepartment").innerText = Selected_Department;  
//   ExecuteOrDelayUntilScriptLoaded(Load_Employees_Per_Department,'sp.js');
// }

}

//-------------------------------------------------------------------------------------------------------------------------------
// GET CURRENT USERNAME 
var Employee_Username = "";
function GetCurrentUsername()
{
var ctxt = new SP.ClientContext('https://intranet.houseofit.com.au/');
this.website = ctxt.get_web();
this.currentUser = website.get_currentUser();
ctxt.load(currentUser);
ctxt.executeQueryAsync(Function.createDelegate(this, this.onSucceess_GetUser), Function.createDelegate(this, this.onFail));
}
function onSucceess_GetUser(sender, args)
 {
 // alert(currentUser.get_loginName());
 var full_username = currentUser.get_loginName();
 var current_username = full_username.split("\\");
  Employee_Username = current_username[1];
  ExecuteOrDelayUntilScriptLoaded(View_Employee_Points_Individual, "sp.js");
  // ExecuteOrDelayUntilScriptLoaded(get_username_from_List, "sp.js");
}

var emp_targetListItem;
function get_username_from_List(){
      
      var clientContext = new SP.ClientContext('https://intranet.houseofit.com.au/');
      var oList = clientContext.get_web().get_lists().getByTitle('LND Participants');
      var camlQuery = new SP.CamlQuery();
      camlQuery.set_viewXml('<View><Query><Where><Eq><FieldRef Name=\'LI_Username\'/>' + 
        '<Value Type=\'Text\'>'+Employee_Username+'</Value></Eq></Where></Query><RowLimit></RowLimit></View>');
        this.emp_targetListItem = oList.getItems(camlQuery);
      clientContext.load(emp_targetListItem);
      clientContext.executeQueryAsync(Function.createDelegate(this, this.get_username_from_List_Succeeded), Function.createDelegate(this, this.onQueryFailed));
}
var ref_id = 0;
function get_username_from_List_Succeeded(){
  // alert(Employee_Username);
    var enumerator = emp_targetListItem.getEnumerator();

    while (enumerator.moveNext()) {
        var listItem = enumerator.get_current();  
        ref_id = listItem.get_item("ID");
    }
    if(ref_id != 0){
        // console.log("employee have records :"+listItem.get_item("ID"));

        
    }
    else{
        // console.log("wa lang sa :"+listItem.get_item("ID"));
    }

}

// -------------------------------------------------------------------------------------------------------------------------

var IT_Employees = [];
var IT_Employees_ID = [];


var Department_Employees_Items;


function Load_All_Employees(){
    Department_Employees_Items = "";
    for(var i=document.getElementById("TBL_Employees").rows.length;i>=1;i--) {
    document.getElementById("TBL_Employees").deleteRow(i-1);}

    var clientContext = new SP.ClientContext('https://intranet.houseofit.com.au/');
    var oList = clientContext.get_web().get_lists().getByTitle('Employee Profile');
    var camlQuery = new SP.CamlQuery();
    camlQuery.set_viewXml(
      '<View>'+
      '<Query>'+
      '<Where>'+
      '<Eq>'+
        '<FieldRef Name=\'LI_Separated\'/>' + 
        '<Value Type=\'Text\'>'+"Active"+'</Value>'+
      '</Eq>'+  
      '</Where>'+
        '<OrderBy>'+
        '<FieldRef Name=\'LI_FirstName\' Ascending=\'true\' />'+
        '</OrderBy>'+
      '</Query>'+
      '<RowLimit>'+
      '</RowLimit>'+
      '</View>');
    this.Department_Employees_Items = oList.getItems(camlQuery);
    clientContext.load(Department_Employees_Items);
    clientContext.executeQueryAsync(Function.createDelegate(this, this.Load_All_Employees_Succeeded), Function.createDelegate(this, this.onQueryFailed));  
}

function Load_All_Employees_Succeeded(sender, args) {
    var listItemsCollection = Department_Employees_Items.getEnumerator();

      for(var i=document.getElementById("TBL_Points_Employees").rows.length;i>1;i--) {
      document.getElementById("TBL_Points_Employees").deleteRow(i-1);}


    while (listItemsCollection.moveNext()) {
      var listItem = listItemsCollection.get_current();
        
      var var_ID = listItem.get_item('LI_EmployeeID');  
      var var_FirstName = listItem.get_item('LI_FirstName');
      var var_MiddleName = listItem.get_item('LI_MiddleName');
      var var_LastName = listItem.get_item('LI_LastName');
      var var_Suffix = listItem.get_item('LI_Suffix');
      var var_Department = listItem.get_item('LI_Department');

      if(var_Suffix == null){var_Suffix = "";}
      Name = var_FirstName +" "+var_LastName+" "+var_Suffix;

        $("#TBL_Points_Employees").append(
        "<tr id='ROW_Emp-"+var_ID+"'>" +
        "<td style='padding-left: 30px !important' id='TD_ID-"+var_ID+"'>"+var_ID+"</td>"+
        "<td id='TD_Name-"+Name+"'>"+Name+"</td>"+
        "<td id='TD_Department-"+var_Department+"'>"+var_Department+"</td>"+
        "<td ><i id='ShowPointsEmp-"+var_ID+"' class='small material-icons icon-blue' style='cursor: pointer' onclick='View_Employee_Points_Clicked(this)'>play_circle_outline</i></td>"+
        "</tr>");
    }
            
}

function Load_Employees_Per_Department(){

      for(var i=document.getElementById("TBL_Employees").rows.length;i>=1;i--) {
      document.getElementById("TBL_Employees").deleteRow(i-1);}

      Employee_Name = [];
      Employee_ID = [];
      Employee_Username = [];


      var clientContext = new SP.ClientContext('https://intranet.houseofit.com.au/');
      var oList = clientContext.get_web().get_lists().getByTitle('Employee Profile');
      var camlQuery = new SP.CamlQuery();
      camlQuery.set_viewXml(
        '<View>'+
        '<Query>'+
        '<Where>'+
        '<And>'+
        '<Eq>'+
          '<FieldRef Name=\'LI_Separated\'/>' + 
          '<Value Type=\'Text\'>'+"Active"+'</Value>'+
          '</Eq>'+  
        '<Eq>'+
        '<FieldRef Name=\'LI_Department\'/>' + 
        '<Value Type=\'Text\'>'+Selected_Department+'</Value>'+
        '</Eq>'+
        '</And>'+
        '</Where>'+
          '<OrderBy>'+
          '<FieldRef Name=\'LI_FirstName\' Ascending=\'true\' />'+
          '</OrderBy>'+
        '</Query>'+
        '<RowLimit>'+
        '</RowLimit>'+
        '</View>');
      this.Department_Employees_Items = oList.getItems(camlQuery);
      clientContext.load(Department_Employees_Items);
      clientContext.executeQueryAsync(Function.createDelegate(this, this.Load_Employees_Per_Department_Succeeded), Function.createDelegate(this, this.onQueryFailed)); 

}

var Employee_Name = [];
var Employee_ID = [];
var Employee_Username = [];
// var Employee_Row_Name = [];

function Load_Employees_Per_Department_Succeeded(sender, args) {
    var listItemsCollection = Department_Employees_Items.getEnumerator();

      for(var i=document.getElementById("TBL_Employees").rows.length;i>=1;i--) {
      document.getElementById("TBL_Employees").deleteRow(i-1);}

    if(Selected_Department != ""){
      $("#TBL_Employees").append(
      "<tr onclick='selectRow(this)' id='ROW-SELECT ALL'>" +
      "<td style='padding-left: 20px !important' >"+
      "<input type='checkbox' id='CB_SELECT_ALL'  />"+
      "<label for='CB-SELECT ALL' class='grey-text text-darken-2'>SELECT ALL</label>"+
      "</td>"+
      "</tr>");

    }

    while (listItemsCollection.moveNext()) {
      var listItem = listItemsCollection.get_current();
        
      var var_FirstName = listItem.get_item('LI_FirstName');
      var var_MiddleName = listItem.get_item('LI_MiddleName');
      var var_LastName = listItem.get_item('LI_LastName');
      var var_Suffix = listItem.get_item('LI_Suffix');

      if(var_Suffix == null){var_Suffix = "";}
      Name = var_FirstName +" "+var_LastName+" "+var_Suffix;

      Employee_Name.push(Name);
      Employee_ID.push(listItem.get_item('LI_EmployeeID'));
      Employee_Username.push(listItem.get_item('LI_Username'));

      $("#TBL_Employees").append(
      "<tr onclick='selectRow(this)' id='ROW-"+listItem.get_item('LI_EmployeeID')+"'>" +
      "<td style='padding-left: 20px !important' id='TD-"+listItem.get_item('LI_EmployeeID')+"'>"+
      "<input type='checkbox' name='CB_EmployeeName' id='Employee-"+listItem.get_item('LI_EmployeeID')+"' onChange='CheckBox_Name_Checked(this)' value='"+Name+"' title='"+listItem.get_item('LI_Username')+"'/>"+
      "<label for='"+listItem.get_item('LI_EmployeeID')+"' class='grey-text text-darken-2'>"+
      Name+
      "</label>"+
      "</td>"+
      "</tr>");

      if(Array_Participant_EmpID.indexOf(listItem.get_item('LI_EmployeeID')) > -1){
        document.getElementById("ROW-"+listItem.get_item('LI_EmployeeID')).remove();
      }

    }


    // for (var i = 0 ; i <= Employee_Name.length - 1; i++){
    //   $("#TBL_Employees").append(
    //   "<tr onclick='selectRow(this)' id='ROW-"+Employee_ID[i]+"'>" +
    //   "<td style='padding-left: 20px !important' id='TD-"+Employee_ID[i]+"'>"+
    //   "<input type='checkbox' name='CB_EmployeeName' id='Employee-"+Employee_ID[i]+"' onChange='CheckBox_Name_Checked(this)' value='"+Employee_Name[i]+"' title='"+Employee_Username[i]+"'/>"+
    //   "<label for='"+Employee_ID[i]+"' class='grey-text text-darken-2'>"+
    //   Employee_Name[i]+
    //   "</label>"+
    //   "</td>"+
    //   "</tr>");

    // }

            $('#CB_SELECT_ALL').on('change', function () {
                if ($(this).prop('checked')) {
                    $("input[name='CB_EmployeeName']").each(function () {
                        $(this).prop('checked', true).trigger('change');
                    });
                } else {
                    $("input[name='CB_EmployeeName']").each(function () {
                        $(this).prop('checked', false).trigger('change');

                      Selected_Employee_Name = [];
                      Selected_Employee_ID = [];
                      Selected_Employee_Username = [];

                    });
                }
            });

            // console.log("Array_Participant_EmpID :"+Array_Participant_EmpID);

      // for(var i = 0;i <= Array_Participant_EmpID .length -1;i++){
      //     document.getElementById("ROW-"+Array_Participant_EmpID[i]).remove();
      // }  


      if($("#TBL_Employees tr").length == 1){
        document.getElementById("ROW-SELECT ALL").remove();
      }

            
}



//-----------------------------------------------------------------------------------------------------------------

function onQueryFailed(sender, args) {

    alert('Request failed. ' + args.get_message() + '\n' + args.get_stackTrace());
}

function EmployeeName_Clicked(Obj){
  // alert(Obj.id);

  // if(Obj.id != EmployeeSelected_ID){
  // EmployeeSelected_ID = Obj.id;
  // EmployeeSelected_Name = IT_Employees[IT_Employees_ID.indexOf(Obj.id)];

  // // document.getElementById("lnk_OpenEntries").click();
  // document.getElementById("Span_SelectedEmployee").innerText = EmployeeSelected_Name;

  // ExecuteOrDelayUntilScriptLoaded(Get_Training_Completed, "sp.js");
  // }
  if(Obj.id.split("-").pop() != EmployeeSelected_ID){
    TD_Name_Selected = Obj.id;
    EmployeeSelected_ID = Obj.id.split("-").pop();
    EmployeeSelected_Name = IT_Employees[IT_Employees_ID.indexOf(Obj.id.split("-").pop())];

    // document.getElementById("lnk_OpenEntries").click();
    document.getElementById("Span_SelectedEmployee").innerText = EmployeeSelected_Name;

    ExecuteOrDelayUntilScriptLoaded(Get_Training_Completed, "sp.js");
  }

}
//-----------------------------------------------------------------------------------------------------------------

function isEmptyOrSpaces(str){
    return str === null || str.match(/^ *$/) !== null;
}
//-----------------------------------------------------------------------------------------------------------------
// ADD TRAINING

//-----------------------------------------------------------------------------------------------------------------
// RETRIEVE STAFF TRAINING


//-----------------------------------------------------------------------------------------------------------------

function selectRow(row)
{
    var firstInput = row.getElementsByTagName('input')[0];
    firstInput.checked = !firstInput.checked;
    firstInput.click();
}


function CheckBox_Name_Checked(Checkbox){
  if(Checkbox.checked == true){
      Selected_Employee_Name.push(Checkbox.value);
      Selected_Employee_ID.push(Checkbox.id.split("-").pop());
      Selected_Employee_Username.push(Checkbox.title)

  }
  else if(Checkbox.checked == false){

      var a = Selected_Employee_Name.indexOf(Checkbox.value);
      if(a != -1) {Selected_Employee_Name.splice(a, 1);}

      var b = Selected_Employee_ID.indexOf(Checkbox.id.split("-").pop());
      if(b != -1) {Selected_Employee_ID.splice(b, 1);}

      var c = Selected_Employee_Username.indexOf(Checkbox.title);
      if(c != -1) {Selected_Employee_Username.splice(c, 1);}

  }

}

//-----------------------------------------------------------------------------------------------------------------
// OPEN CLOSE MODAL

var Activity_Function = "";

function Add_Activity_Clicked(){
  OpenNewEntry_Modal();
  Activity_Function = "Add";
}

function OpenNewEntry_Modal(){
  $('#ModalNewEntry').modal('open');
}
function CloseNewEntry_Modal(){
  $('#ModalNewEntry').modal('close');

  document.getElementById("Date_ActivityDate").value = "";
  document.getElementById("TB_Type").value = "";
  document.getElementById("TB_Topic").value = "";
  document.getElementById("TB_Duration").value = "";
  document.getElementById("TB_Facilitator").value = "";


}

function OpenPoints_Modal(){
  $('#ModalPoints').modal('open');
}
function ClosePoints_Modal(){
  $('#ModalPoints').modal('close');
}


//-----------------------------------------------------------------------------------------------------------------
function Validate_ActivityForm() {
  if(isEmptyOrSpaces(document.getElementById("Date_ActivityDate").value) ||
    isEmptyOrSpaces(document.getElementById("TB_Type").value) ||
    isEmptyOrSpaces(document.getElementById("TB_Topic").value) ||
    isEmptyOrSpaces(document.getElementById("TB_Duration").value) ||
    isEmptyOrSpaces(document.getElementById("TB_Facilitator").value)){
      swal(
      'Oops...',
      'Please fill all the fields!',
      'error')
  }
  else{
    if(Activity_Function == "Add"){
      Add_Activity();
      // alert("add");
    }
    else if(Activity_Function == "Edit"){
      Update_Activitiy();
      // alert("edit");
    }
  }
}

// ADD ACTIVITIES
var oListItem_Add_Activity;
function Add_Activity() {
  var siteUrl = 'https://intranet.houseofit.com.au/';
  var clientContext = new SP.ClientContext(siteUrl);
  var oList = clientContext.get_web().get_lists().getByTitle('LND Activities');

  var itemCreateInfo = new SP.ListItemCreationInformation();
  this.oListItem_Add_Activity = oList.addItem(itemCreateInfo);

    oListItem_Add_Activity.set_item('LI_Date', document.getElementById("Date_ActivityDate").value);
    oListItem_Add_Activity.set_item('LI_Type', document.getElementById("TB_Type").value);
    oListItem_Add_Activity.set_item('LI_Topic', document.getElementById("TB_Topic").value);
    oListItem_Add_Activity.set_item('LI_Duration', document.getElementById("TB_Duration").value);
    oListItem_Add_Activity.set_item('LI_Facilitator', document.getElementById("TB_Facilitator").value);


    oListItem_Add_Activity.update();
    clientContext.load(oListItem_Add_Activity);
    clientContext.executeQueryAsync(Function.createDelegate(this, this.Add_Activity_Succeeded), Function.createDelegate(this, this.onQueryFailed));
}
function Add_Activity_Succeeded() {
  swal({
  type: 'success',
  title: 'Activity has ben Added',
  showConfirmButton: false,
  timer: 700
});

CloseNewEntry_Modal();
ExecuteOrDelayUntilScriptLoaded(Get_Activities, "sp.js");
}

// EDIT ACTIVITIES

var Get_Activity_Items;
function Get_Activity_To_Update(){
        var clientContext = new SP.ClientContext('https://intranet.houseofit.com.au/');
        var oList = clientContext.get_web().get_lists().getByTitle('LND Activities');
        var camlQuery = new SP.CamlQuery();
        camlQuery.set_viewXml('<View><Query><Where><Geq><FieldRef Name=\'ID\'/>' +
        '<Value Type=\'Number\'>'+Activitiy_ID_ToEdit+'</Value></Geq></Where></Query><RowLimit>1</RowLimit></View>');
        this.Get_Activity_Items = oList.getItems(camlQuery);
        clientContext.load(Get_Activity_Items);
        clientContext.executeQueryAsync(Function.createDelegate(this, this.Get_Activity_To_Update_Suceeded), Function.createDelegate(this, this.onQueryFailed));
}
function Get_Activity_To_Update_Suceeded(){
  var listItemsCollection = Get_Activity_Items.getEnumerator();

  OpenNewEntry_Modal();

  Activity_Function = "Edit";

    while (listItemsCollection.moveNext()) {
      var listItem = listItemsCollection.get_current();

      document.getElementById("Date_ActivityDate").value = listItem.get_item('LI_Date');
      document.getElementById("TB_Type").value = listItem.get_item('LI_Type');
      document.getElementById("TB_Topic").value = listItem.get_item('LI_Topic');
      document.getElementById("TB_Duration").value = listItem.get_item('LI_Duration');
      document.getElementById("TB_Facilitator").value = listItem.get_item('LI_Facilitator');

    }
      
}

var oListItem_Update_Activitiy;
function Update_Activitiy() {
  var siteUrl = 'https://intranet.houseofit.com.au/';
  var clientContext = new SP.ClientContext(siteUrl);
  var oList = clientContext.get_web().get_lists().getByTitle('LND Activities');

  this.oListItem_Update_Activitiy = oList.getItemById(Activitiy_ID_ToEdit);

    oListItem_Update_Activitiy.set_item('LI_Date', document.getElementById("Date_ActivityDate").value);
    oListItem_Update_Activitiy.set_item('LI_Type', document.getElementById("TB_Type").value);
    oListItem_Update_Activitiy.set_item('LI_Topic', document.getElementById("TB_Topic").value);
    oListItem_Update_Activitiy.set_item('LI_Duration', document.getElementById("TB_Duration").value);
    oListItem_Update_Activitiy.set_item('LI_Facilitator', document.getElementById("TB_Facilitator").value);


    oListItem_Update_Activitiy.update();
    clientContext.load(oListItem_Update_Activitiy);
    clientContext.executeQueryAsync(Function.createDelegate(this, this.Update_Activitiy_Succeeded), Function.createDelegate(this, this.onQueryFailed));
}

function Update_Activitiy_Succeeded(){
  swal({
  type: 'success',
  title: 'Activity Has Been Updated',
  showConfirmButton: false,
  timer: 700
});
CloseNewEntry_Modal();
ExecuteOrDelayUntilScriptLoaded(Get_Activities, "sp.js");

}

// DELETE ACTIVITY

var oListItem_Delete_Activitiy;
function Delete_Activity(ActivityID){
  var siteUrl = 'https://intranet.houseofit.com.au/';
  var clientContext = new SP.ClientContext(siteUrl);
  var oList = clientContext.get_web().get_lists().getByTitle('LND Activities');
  this.oListItem_Delete_Activitiy = oList.getItemById(ActivityID);
  oListItem_Delete_Activitiy.deleteObject();
  clientContext.executeQueryAsync(Function.createDelegate(this, this.Delete_Activity_Succeeded), Function.createDelegate(this, this.onQueryFailed));
}
function Delete_Activity_Succeeded(){
    // swal(
    //   'Deleted!',
    //   'Activity has been deleted.',
    //   'success'
    // )
ExecuteOrDelayUntilScriptLoaded(Get_Activities, "sp.js");
}

//-----------------------------------------------------------------------------------------------------------------
// VIEW ACTIVITIES

var Get_Activities_ListItems;
function Get_Activities(){

  context = SP.ClientContext.get_current();
  var Departments = context.get_web().get_lists().getByTitle("LND Activities");
  var camlQuery_Department = SP.CamlQuery.createAllItemsQuery();
  this.Get_Activities_ListItems = Departments.getItems(camlQuery_Department);



  context.load(Get_Activities_ListItems);
  context.executeQueryAsync(Get_Activities_Succeeded, onQueryFailed);
}
function Get_Activities_Succeeded(){

    var listItemEnumerator = Get_Activities_ListItems.getEnumerator();    
    var count = 0;

      for(var i=document.getElementById("Table_Activities").rows.length;i>1;i--) {
    document.getElementById("Table_Activities").deleteRow(i-1);}

    while (listItemEnumerator.moveNext()) {
        var oListItem = listItemEnumerator.get_current();
        count++;
        var var_ItemID = oListItem.get_item('ID');
        var var_Activity = oListItem.get_item('LI_Topic');
        var var_Date = oListItem.get_item('LI_Date');
        var var_Duration = oListItem.get_item('LI_Duration');

        var ParticipantCount = oListItem.get_item('LI_ParticipantsCount');

        if(ParticipantCount == null){ParticipantCount = 0}


                              $("#Table_Activities").append("<tr >" +

                               // '<td ><a class="btn-floating waves-effect waves-light light-blue z-depth-2 hoverable " id="View-'+var_ItemID+'" Value="'+var_ItemID+'" onclick="ViewButtonClicked(this)" style="margin-left:40px !important"><i class=" material-icons" >open_in_new</i></a></td>' + 

                               "<td >"+oListItem.get_item('LI_Date')+"</td>" +
                               "<td >"+oListItem.get_item('LI_Type')+"</td>"  +
                               "<td >"+oListItem.get_item('LI_Topic')+"</td>"  +
                               "<td ><span style='margin-left:10px !important'>"+oListItem.get_item('LI_Duration')+" Hr(s)</span></td>"  +
                               "<td >"+oListItem.get_item('LI_Facilitator')+"</td>"  +
                               "<td  class='green-text' ><span style='margin-left:60px !important;font-weight: 500 !important'>"+ParticipantCount+"</span></td>"  +
                               "<td >"+

                               "<a class='dropdown-button btn waves-effect waves-light btn-flat btn-floating transparent' href='#' data-activates='Actions-"+var_ItemID+"'><i class='large material-icons icon-blue'>more_vert</i></a>"+

                               "<ul id='Actions-"+var_ItemID+"' class='dropdown-content' style='width: auto !important;'>"+

                               '<li><a id="EDIT-'+var_ItemID+'" value="'+var_ItemID+'" onclick="Edit_Activity_Clicked(this)" style="text-decoration: none;"><i class="material-icons left">mode_edit</i>EDIT</a></li>'+

                               '<li ><a style="text-decoration: none;" id="DELETE-'+var_ItemID+'" value="'+var_Activity+'" onclick="Delete_Activity_Clicked(this)" ><i class="material-icons left">delete_forever</i>DELETE</a></li>'+

                               '<li><a style="text-decoration: none;" id="VIEW-'+var_ItemID+'" value="'+var_Activity+'" name="'+var_Date+"()"+var_Duration+'"  onclick="View_Participants_Clicked(this)" ><i class="material-icons left">people</i>VIEW PARTICIPANTS</a></li>'+

                               "</ul>"+
                               "</td>" + 

                               "</tr>"

                               );
     

                              $("#Table_Activities_List").append("<tr align='middle'>" +
                               "<td align='left'>"+oListItem.get_item('LI_Date')+"</td>" +
                               "<td align='left'>"+oListItem.get_item('LI_Type')+"</td>"  +
                               "<td align='left'>"+oListItem.get_item('LI_Topic')+"</td>"  +
                               "<td ><span style='margin-left:10px !important'>"+oListItem.get_item('LI_Duration')+" Hr(s)</span></td>"  +
                               "<td align='left'>"+oListItem.get_item('LI_Facilitator')+"</td>"  +

                               "</tr>"

                               );

                            $('.dropdown-button').dropdown({
                                inDuration: 225,
                                outDuration: 225,
                                constrainWidth: false, // Does not change width of dropdown to that of the activator
                                hover: false, // Activate on hover
                                gutter: 0, // Spacing from edge
                                belowOrigin: false, // Displays dropdown below the button
                                alignment: 'right', // Displays dropdown with edge aligned to the left of button
                                stopPropagation: false // Stops event propagation
                              }
                            );

                            

    }



}

//----------------------------------------------------------------------------------------------------------------


//-----------------------------------------------------------------------------------------------------------------
// TABLE ACTIONS 
var Activitiy_ID_ToEdit;

function Edit_Activity_Clicked(Edit) {
  // alert(Edit.id.split("-").pop());
  Activitiy_ID_ToEdit = Edit.id.split("-").pop();
  Get_Activity_To_Update();
}

function Delete_Activity_Clicked(Delete) {
  // alert(Delete.id.split("-").pop());

swal({
  title: 'Are you sure?',
  text: "You won't be able to revert this!",
  type: 'warning',
  showCancelButton: true,
  confirmButtonColor: '#3085d6',
  cancelButtonColor: '#d33',
  confirmButtonText: 'Yes, delete it!'
}).then((result) => {
    Delete_Activity(Delete.id.split("-").pop());
})

  
}

var Selected_Employee_ID = [];
var Selected_Employee_Name = [];
var Selected_Employee_Username = [];
var Selected_Activity_ID;
var Selected_Activity_Name;
var Selected_Department = "";

function View_Participants_Clicked(View) {
  // alert(View.id);
  Selected_Activity_ID = View.id.split("-").pop();
  document.getElementById("Reveal_Activator").click();
  document.getElementById("Div_EmployeeNames").style.display = "block";
  document.getElementById("Div_Activities").classList.remove("s12");
  document.getElementById("Div_Activities").classList.add("s10");

  var val = View.name.split("()");

  document.getElementById("TB_P_Activity").value = View.getAttribute('value');
  
  document.getElementById("Date_P_ActivityDate").value = val[0];

  document.getElementById("TB_P_Duration").value = val[1];

  Selected_Activity_Name = View.getAttribute('value');

  console.log(val);

  ExecuteOrDelayUntilScriptLoaded(Get_Participants,'sp.js');
}
//-----------------------------------------------------------------------------------------------------------------

function Close_Reveal() {
document.getElementById("Div_EmployeeNames").style.display = "none";
document.getElementById("Div_Activities").classList.remove("s10");
document.getElementById("Div_Activities").classList.add("s12");

					document.getElementById('DP_P_Points').selectedIndex = 0;
					$('#DP_P_Points').material_select();

				      for(var i=document.getElementById("TBL_Employees").rows.length;i>=1;i--) {
				      document.getElementById("TBL_Employees").deleteRow(i-1);}

				      document.getElementById("Div_SelectedDepartment").innerHTML = "Select a Department";
				      
                  Selected_Department = "";
                  Selected_Employee_ID = [];
                  Selected_Employee_Name = [];

}

//-----------------------------------------------------------------------------------------------------------------


function Validate_Add_Empoyees_As_Participants() {

  console.log(parseInt(document.getElementById("DP_P_Points").value) * parseInt(document.getElementById("TB_P_Duration").value));

  if(isEmptyOrSpaces(document.getElementById("DP_P_Points").value)){
      swal(
      'Oops...',
      'Please select the points',
      'error')  
  }
  else{

    // console.log("Selected_Employee_ID : "+Selected_Employee_ID);
    // console.log("Selected_Employee_Name : "+Selected_Employee_Name);
    // console.log("Selected_Department : "+Selected_Department);
    // console.log("Selected_Activity_Name : "+Selected_Activity_Name);
    // console.log("Selected_Activity_ID : "+Selected_Activity_ID);
    // console.log("Points : "+document.getElementById("DP_P_Points").value);
    // console.log("Date : "+document.getElementById("Date_P_ActivityDate").value);

    if(Selected_Employee_ID.length > 0 ){
      for(var i = 0; i<=Selected_Employee_ID.length;i++){
        
        if(i != Selected_Employee_ID.length){
          var Points = parseFloat(document.getElementById("DP_P_Points").value) * parseFloat(document.getElementById("TB_P_Duration").value); 

            Add_Empoyees_As_Participants(Selected_Employee_ID[i],Selected_Employee_Name[i],Selected_Employee_Username[i],Selected_Department,Selected_Activity_Name,Selected_Activity_ID,Points,document.getElementById("Date_P_ActivityDate").value);
        }
        else{
                swal({
                type: 'success',
                title: 'Participants has ben Added',
                showConfirmButton: false,
                timer: 2000});

                setTimeout(function(){
                 ExecuteOrDelayUntilScriptLoaded(Get_Participants, "sp.js"); 

				    if(Selected_Employee_ID.length > 0){
				      for(var i = 0;i <= Selected_Employee_ID.length -1;i++){
				        document.getElementById("ROW-"+Selected_Employee_ID[i]).remove();
				      } 
				    }  

                  if(document.getElementById("CB_SELECT_ALL").checked == true){
                    document.getElementById("ROW-SELECT ALL").remove();
                    // document.getElementById("ROW-SELECT ALL").style.display = "none";
                    // document.getElementById("CB_SELECT_ALL").checked = false;
                    // document.getElementById("CB_SELECT_ALL").setAttribute('disabled', 'disabled');

                    // Selected_Department = "";
                    // document.getElementById("BTN_AddParticipants").style.display = "none";

                  }

                  Selected_Employee_ID = [];
                  Selected_Employee_Name = [];

               }, 1200);

        }
      }
    }
    else{
      swal(
      'Oops...',
      'No Employee Selected',
      'error')  
    }

  }

}

var oListItem_Add_Empoyees_As_Participants;
function Add_Empoyees_As_Participants(Employee_ID,Employee_Name,Employee_Username,Department,Activity_Name,Activity_ID,Points,Activity_Date){
  var siteUrl = 'https://intranet.houseofit.com.au/';
  var clientContext = new SP.ClientContext(siteUrl);
  var oList = clientContext.get_web().get_lists().getByTitle('LND Participants');

  var itemCreateInfo = new SP.ListItemCreationInformation();
  this.oListItem_Add_Empoyees_As_Participants = oList.addItem(itemCreateInfo);

    oListItem_Add_Empoyees_As_Participants.set_item('LI_EmployeeID', Employee_ID);
    oListItem_Add_Empoyees_As_Participants.set_item('LI_EmployeeName', Employee_Name);
    oListItem_Add_Empoyees_As_Participants.set_item('LI_Username', Employee_Username);
    oListItem_Add_Empoyees_As_Participants.set_item('LI_EmployeeDepartment', Department);
    oListItem_Add_Empoyees_As_Participants.set_item('LI_Activity', Activity_Name);
    oListItem_Add_Empoyees_As_Participants.set_item('LI_ActivityID', Activity_ID);
    oListItem_Add_Empoyees_As_Participants.set_item('LI_Points', Points);
    oListItem_Add_Empoyees_As_Participants.set_item('LI_ActivityDate', Activity_Date);

    oListItem_Add_Empoyees_As_Participants.update();
    clientContext.load(oListItem_Add_Empoyees_As_Participants);
    clientContext.executeQueryAsync(Function.createDelegate(this, this.Add_Empoyees_As_Participants_Succeeded), Function.createDelegate(this, this.onQueryFailed));
}
function Add_Empoyees_As_Participants_Succeeded() {

    // if(Selected_Employee_ID.length > 0){
    //   for(var i = 0;i <= Selected_Employee_ID.length -1;i++){
    //     document.getElementById("ROW-"+Selected_Employee_ID[i]).remove();
    //   } 
    // }  
}

//-----------------------------------------------------------------------------------------------------------------
// GET PARTICIPANTS
var Participants_Items;
function Get_Participants() {
    for(var i=document.getElementById("Table_Participants").rows.length;i>1;i--) {
    document.getElementById("Table_Participants").deleteRow(i-1);}

    var clientContext = new SP.ClientContext('https://intranet.houseofit.com.au/');
    var oList = clientContext.get_web().get_lists().getByTitle('LND Participants');
    var camlQuery = new SP.CamlQuery();
    camlQuery.set_viewXml(
      '<View>'+
      '<Query>'+
      '<Where>'+
      '<Eq>'+
        '<FieldRef Name=\'LI_ActivityID\'/>' + 
        '<Value Type=\'Text\'>'+Selected_Activity_ID+'</Value>'+
      '</Eq>'+  
      '</Where>'+
        '<OrderBy>'+
        '<FieldRef Name=\'LI_EmployeeDepartment\' Ascending=\'true\' />'+
        '</OrderBy>'+
      '</Query>'+
      '<RowLimit>'+
      '</RowLimit>'+
      '</View>');
    this.Participants_Items = oList.getItems(camlQuery);
    clientContext.load(Participants_Items);
    clientContext.executeQueryAsync(Function.createDelegate(this, this.Get_Participants_Succeeded), Function.createDelegate(this, this.onQueryFailed));  
}
var count_participants = 0;

var Array_Participant_EmpID = [];
function Get_Participants_Succeeded() {
    var listItemsCollection = Participants_Items.getEnumerator();
    count_participants = 0;
    Array_Participant_EmpID = [];
    while (listItemsCollection.moveNext()) {
      var listItem = listItemsCollection.get_current();
      Array_Participant_EmpID.push(listItem.get_item('LI_EmployeeID'));
      count_participants++;

                              $("#Table_Participants").append("<tr align='middle'>" +

                               "<td align='left'>"+listItem.get_item('LI_EmployeeID')+"</td>" +
                               "<td align='left'>"+listItem.get_item('LI_EmployeeName')+"</td>"  +
                               "<td align='left'>"+listItem.get_item('LI_EmployeeDepartment')+"</td>"  +
                               "<td align='left'>"+listItem.get_item('LI_Points')+"</td>"  +

                              "<td ><a class='' style='cursor: pointer;' id='RemoveParticipant-"+listItem.get_item('ID')+"' name='"+listItem.get_item('LI_EmployeeDepartment')+"' onclick='Remove_Participant_From_Activity(this)'><i class='material-icons ' style='color: #ef5350;'>backspace</i></a></td>" +

                               "</tr>"

                               );

    }

// console.log("Selected_Activity_ID :"+Selected_Activity_ID);
Update_Participants_Count(Selected_Activity_ID,count_participants);


}
var oListItem_Number_Participants;
function Update_Participants_Count(ID,Count) {
  var siteUrl = 'https://intranet.houseofit.com.au/';
  var clientContext = new SP.ClientContext(siteUrl);
  var oList = clientContext.get_web().get_lists().getByTitle('LND Activities');

  this.oListItem_Number_Participants = oList.getItemById(ID);

    oListItem_Number_Participants.set_item('LI_ParticipantsCount', Count);

    oListItem_Number_Participants.update();
    clientContext.load(oListItem_Number_Participants);
    clientContext.executeQueryAsync(Function.createDelegate(this, this.Update_Participants_Count_Succeeded), Function.createDelegate(this, this.onQueryFailed));
}
function Update_Participants_Count_Succeeded(){
	ExecuteOrDelayUntilScriptLoaded(Get_Activities, "sp.js");
}

  var LightTableFilter = (function(Arr) {

    var _input;

    function _onInputEvent(e) {
      _input = e.target;
      var tables = document.getElementsByClassName(_input.getAttribute('data-table'));
      Arr.forEach.call(tables, function(table) {
        Arr.forEach.call(table.tBodies, function(tbody) {
          Arr.forEach.call(tbody.rows, _filter);
        });
      });
    }

    function _filter(row) {
      var text = row.textContent.toLowerCase(), val = _input.value.toLowerCase();
      row.style.display = text.indexOf(val) === -1 ? 'none' : 'table-row';
    }

    return {
      init: function() {
        var inputs = document.getElementsByClassName('light-table-filter');
        Arr.forEach.call(inputs, function(input) {
          input.oninput = _onInputEvent;
        });
      }
    };
  })(Array.prototype);
//-----------------------------------------------------------------------------------------------------------------

// REMOVE TRAINING FROM COMPLETED 
var oListItem_Participant;


function Remove_Participant_From_Activity(Participant){
  var Participant_ID = Participant.id.split("-").pop();
      
  var siteUrl = 'https://intranet.houseofit.com.au/';
  var clientContext = new SP.ClientContext(siteUrl);
  var oList = clientContext.get_web().get_lists().getByTitle('LND Participants');
  this.oListItem_Participant = oList.getItemById(Participant_ID);
  oListItem_Participant.deleteObject();
  clientContext.executeQueryAsync(Function.createDelegate(this, this.Remove_Participant_From_Activity_Succeeded), Function.createDelegate(this, this.onQueryFailed));

}
function Remove_Participant_From_Activity_Succeeded() {
  ExecuteOrDelayUntilScriptLoaded(Get_Participants, "sp.js");
        swal({
        type: 'success',
        title: 'Participant has ben removed',
        showConfirmButton: false,
        timer: 500
      });


     if(Selected_Department !=  ""){
      // console.log("Selected_Department :"+Selected_Department);
      setTimeout(function(){ ExecuteOrDelayUntilScriptLoaded(Load_Employees_Per_Department, "sp.js"); }, 500);

     }

}

//-----------------------------------------------------------------------------------------------------------------

  var TableFilter_EmployeePoints = (function(Arr) {

    var _input;

    function _onInputEvent(e) {
      _input = e.target;
      var tables = document.getElementsByClassName(_input.getAttribute('data-table'));
      Arr.forEach.call(tables, function(table) {
        Arr.forEach.call(table.tBodies, function(tbody) {
          Arr.forEach.call(tbody.rows, _filter);
        });
      });
    }

    function _filter(row) {
      var text = row.textContent.toLowerCase(), val = _input.value.toLowerCase();
      row.style.display = text.indexOf(val) === -1 ? 'none' : 'table-row';
    }

    return {
      init: function() {
        var inputs = document.getElementsByClassName('EmpPoints-table-filter');
        Arr.forEach.call(inputs, function(input) {
          input.oninput = _onInputEvent;
        });
      }
    };
  })(Array.prototype);

var Selected_Employee_ID_EmpPoints;

function View_Employee_Points_Clicked(element) {
  // alert(element.id.split("-").pop());
  Selected_Employee_ID_EmpPoints = element.id.split("-").pop();
  ExecuteOrDelayUntilScriptLoaded(View_Employee_Points,'sp.js');
}
var View_Employee_Points_Items;
function View_Employee_Points() {
    var clientContext = new SP.ClientContext('https://intranet.houseofit.com.au/');
    var oList = clientContext.get_web().get_lists().getByTitle('LND Participants');
    var camlQuery = new SP.CamlQuery();
    camlQuery.set_viewXml(
      '<View>'+
      '<Query>'+
      '<Where>'+
      '<Eq>'+
        '<FieldRef Name=\'LI_EmployeeID\'/>' + 
        '<Value Type=\'Text\'>'+Selected_Employee_ID_EmpPoints+'</Value>'+
      '</Eq>'+  
      '</Where>'+
      '</Query>'+
      '<RowLimit>'+
      '</RowLimit>'+
      '</View>');
    this.View_Employee_Points_Items = oList.getItems(camlQuery);
    clientContext.load(View_Employee_Points_Items);
    clientContext.executeQueryAsync(Function.createDelegate(this, this.View_Employee_Points_Succeeded), Function.createDelegate(this, this.onQueryFailed));  
}
function View_Employee_Points_Succeeded(){
    var listItemsCollection = View_Employee_Points_Items.getEnumerator();

    var Array_Activity = [];
    var Array_ActivityDate = [];
    var Array_ActivityPoints = [];

    $("#Div_AttendedActivities").empty();

    while (listItemsCollection.moveNext()) {
      var listItem = listItemsCollection.get_current();
        
      Array_ActivityPoints.push(listItem.get_item('LI_Points'));

      $("#Div_AttendedActivities").append(
        "<div class='row card-panel '>"+
                "<div class='row'>"+
                    "<div class='col s2'>"+
                      "<label class='grey-text ' style='font-weight: 500 !important;'>ACTIVITY :</label>"+
                    "</div>"+
                    "<div class='col s10'>"+
                      "<label class='grey-text text-darken-2' style='font-weight: bold !important;font-size: 15px !important'>"+listItem.get_item('LI_Activity')+"</label>"+
                    "</div>"+
                "</div>"+
                "<div class='row'>"+
                    "<div class='col s2'>"+
                      "<label class='grey-text ' style='font-weight: 500 !important;'>DATE :</label>"+
                    "</div>"+
                    "<div class='col s10'>"+
                      "<label class='grey-text text-darken-2' style='font-weight: bold !important;'>"+listItem.get_item('LI_ActivityDate')+"</label>"+
                    "</div>"+
                "</div>"+
                "<div class='row'>"+
                    "<div class='col s2'>"+
                      "<label class='grey-text ' style='font-weight: 500 !important;'>POINTS :</label>"+
                    "</div>"+
                    "<div class='col s10'>"+
                      "<label class='green-text' style='font-weight: bold !important;'>"+listItem.get_item('LI_Points')+"</label>"+
                    "</div>"+
                "</div>"+      
        "</div>" 
      );
    }

    var TotalPoints = 0;
    for(var i = 0; i <= Array_ActivityPoints.length-1; i++){
      TotalPoints = TotalPoints +  parseInt(Array_ActivityPoints[i]);
    }
    document.getElementById("LBL_TotalPoints").innerHTML = TotalPoints;
}
//-----------------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------------
// GET INDIVIDUAL ACTIVITIES ATTENDED AND TOTAL POINTS

var Individual_Items;
function View_Employee_Points_Individual() {
    // alert(Employee_Username);
    var clientContext = new SP.ClientContext('https://intranet.houseofit.com.au/');
    var oList = clientContext.get_web().get_lists().getByTitle('LND Participants');
    var camlQuery = new SP.CamlQuery();
    camlQuery.set_viewXml(
      '<View>'+
      '<Query>'+
      '<Where>'+
      '<Eq>'+
        '<FieldRef Name=\'LI_Username\'/>' + 
        '<Value Type=\'Text\'>'+Employee_Username+'</Value>'+
      '</Eq>'+  
      '</Where>'+
      '</Query>'+
      '<RowLimit>'+
      '</RowLimit>'+
      '</View>');
    this.Individual_Items = oList.getItems(camlQuery);
    clientContext.load(Individual_Items);
    clientContext.executeQueryAsync(Function.createDelegate(this, this.View_Employee_Points_Individual_Succeeded), Function.createDelegate(this, this.onQueryFailed));  
}
function View_Employee_Points_Individual_Succeeded(){
    var listItemsCollection = Individual_Items.getEnumerator();

    var Array_Activity = [];
    var Array_ActivityDate = [];
    var Array_ActivityPoints = [];

    var ref_id = 0;

    $("#Div_Employee_Activities_Attended").empty();

    while (listItemsCollection.moveNext()) {
      var listItem = listItemsCollection.get_current();
          

      ref_id = listItem.get_item('ID');

      if(ref_id != 0)
      {
        Array_ActivityPoints.push(listItem.get_item('LI_Points'));

        $("#Div_Employee_Activities_Attended").append(
          "<div class='row card-panel '>"+
                  "<div class='row'>"+
                      "<div class='col s2'>"+
                        "<label class='grey-text ' style='font-weight: 500 !important;'>ACTIVITY :</label>"+
                      "</div>"+
                      "<div class='col s10'>"+
                        "<label class='grey-text text-darken-2' style='font-weight: bold !important;font-size: 15px !important'>"+listItem.get_item('LI_Activity')+"</label>"+
                      "</div>"+
                  "</div>"+
                  "<div class='row'>"+
                      "<div class='col s2'>"+
                        "<label class='grey-text ' style='font-weight: 500 !important;'>DATE :</label>"+
                      "</div>"+
                      "<div class='col s10'>"+
                        "<label class='grey-text text-darken-2' style='font-weight: bold !important;'>"+listItem.get_item('LI_ActivityDate')+"</label>"+
                      "</div>"+
                  "</div>"+
                  "<div class='row'>"+
                      "<div class='col s2'>"+
                        "<label class='grey-text ' style='font-weight: 500 !important;'>POINTS :</label>"+
                      "</div>"+
                      "<div class='col s10'>"+
                        "<label class='green-text' style='font-weight: bold !important;'>"+listItem.get_item('LI_Points')+"</label>"+
                      "</div>"+
                  "</div>"+      
          "</div>" 
        );
      }

    }
    // alert(Array_ActivityPoints);
    var TotalPoints = 0;
    for(var i = 0; i <= Array_ActivityPoints.length-1; i++){
      TotalPoints = TotalPoints +  parseInt(Array_ActivityPoints[i]);
    }
    document.getElementById("LBL_TotalPoints_Individual").innerHTML = TotalPoints;
}
//-----------------------------------------------------------------------------------------------------------------
  // FILTER ACTIVITIES TABLE
  var TableFilter_ActivitiesTable = (function(Arr) {

    var _input;

    function _onInputEvent(e) {
      _input = e.target;
      var tables = document.getElementsByClassName(_input.getAttribute('data-table'));
      Arr.forEach.call(tables, function(table) {
        Arr.forEach.call(table.tBodies, function(tbody) {
          Arr.forEach.call(tbody.rows, _filter);
        });
      });
    }

    function _filter(row) {
      var text = row.textContent.toLowerCase(), val = _input.value.toLowerCase();
      row.style.display = text.indexOf(val) === -1 ? 'none' : 'table-row';
    }

    return {
      init: function() {
        var inputs = document.getElementsByClassName('activities-table-filter');
        Arr.forEach.call(inputs, function(input) {
          input.oninput = _onInputEvent;
        });
      }
    };
  })(Array.prototype);


//-----------------------------------------------------------------------------------------------------------------


//-----------------------------------------------------------------------------------------------------------------



//-----------------------------------------------------------------------------------------------------------------



//-----------------------------------------------------------------------------------------------------------------

 </script>

<body>

<main>

 <div class="fixed-action-btn horizontal">

    <a id="Btn_AddActivity" class="btn-floating btn-large waves-effect waves-light red z-depth-3 btn-large hoverable " onclick="Add_Activity_Clicked()" >
      <i class="large material-icons">add</i>h
    </a>
  </div>


<div class="row card-panel z-depth-0 grey lighten-3" >

        <div class="col s2 card-panel " id="Div_EmployeeNames" style="padding-left: 0px !important ; padding-right: 0px !important;">
          <div class="row card-panel CenterTextInSpan z-depth-0">
        <a class='dropdown-button light-blue btn white-text' style="text-decoration: none;font-weight: 500;" href='#' data-activates='UL_DropdownDepartment' ><i class="material-icons left">group</i>DEPARTMENT</a> 
      </div>
        
            <div id="Div_SelectedDepartment" class="light-blue white-text" style="height: 50px !important;font-size: 18px;text-align: center;vertical-align: middle;line-height: 50px;font-weight: 500; ">
              SELECT A DEPARTMENT
            </div>

            <table class="responsive-table highlight" id="TBL_Employees"></table>
        </div>

        <div class="col " id="Div_Activities">

        <div class="card ">

          <div class="card-content" style="overflow-y: auto; height:1030px; ">
            <span class="card-title light-blue-text flow-text " style="font-weight: 500">LEARNING & DEVELOPMENT ACTIVITIES<a class="activator " id="Reveal_Activator" style="display: none;"></a><i class="material-icons right"></i></span>


<!--             <div class="row">
              <div class="ui search" style="height: 50px !important">
                <div class="ui icon input">
                  <input class="prompt grey-text text-darken-2 activities-table-filter"   type="search2" placeholder="Search Here" style="width: 280px !important;" data-table="order-table-Activities">
                  <i class="search icon" style="margin-right: 10px !important"></i>
                </div>
              </div>
            </div>
 -->
            <div class="row"></div><div class="row"></div><div class="row"></div><div class="row"></div><div class="row"></div>
            
            <div class="row">
            	<div class="row">
              <div class="col s8">
                <div class="ui search" style="height: 50px !important">
                  <div class="ui icon input">
                    <input class="prompt grey-text text-darken-2 activities-table-filter"   type="search2" placeholder="Search Here" style="width: 400px !important;" data-table="order-table-Activities">
                    <i class="search icon" style="margin-right: 10px !important"></i>
                  </div>
                </div>
              </div>

              <div class="col s4">
                  <a class="waves-effect waves-light AlignButtonRight light-blue btn" onclick="OpenPoints_Modal()" style="text-decoration: none;"><i class="material-icons left">open_in_new</i>EMPLOYEE ACCUMULATED POINTS</a> 
              </div>

            	</div>
            	<div class="row"></div>
            	<div class="row"></div>
              <table id="Table_Activities" class="ui  table order-table-Activities">
                <thead>
                  <tr>
                    <!-- <th>VIEW PARTICIPANTS</th> -->
                    <th class="grey-text text-darken-2">DATE</th>
                    <th class="grey-text text-darken-2">TYPE</th>
                    <th class="grey-text text-darken-2">TOPIC/SUBJECT</th>
                    <th class="grey-text text-darken-2">DURATION</th>
                    <th class="grey-text text-darken-2">FACILITATOR</th>
                    <th class="grey-text text-darken-2">TOTAL PARTICIPANTS</th>
                    <th class="grey-text text-darken-2"></th>
                  </tr>
                </thead>
              </table>
            </div>
          </div>
          <div class="card-reveal">
            <span class=" light-blue-text"><i class="card-title material-icons right" onclick="Close_Reveal()">close</i></span>
            
            <div class="row">
              <div class="col s4 ">
                <div class="row"></div><div class="row"></div><div class="row"></div><div class="row"></div>
                <div class="row"></div><div class="row"></div>
                
                <h6 class="light-blue-text" style="font-weight: 500 !important;font-size: 18px !important">ADD PARTICIPANTS</h6>
                <div class="row card-panel">
                  <div class="col s12">
                      <div class="input-field row">
                            <input id="TB_P_Activity" type="text" placeholder="" disabled>
                            <label for="TB_P_Activity">ACTIVITY</label>
                      </div>
                      <div class="input-field row">
                            <input id="TB_P_Duration" type="text" placeholder="" disabled>
                            <label for="TB_P_Duration">DURATION</label>
                      </div>    
                      <div class="input-field row">
                            <label>DATE</label>
                            <input type = "text" class = "datepicker" id="Date_P_ActivityDate" placeholder="" disabled>    
                      </div>   
                      <div class="input-field">
                          <select id="DP_P_Points">
                            <option value="" disabled selected>Choose Points</option>
                              <option value="1">1</option>
                              <option value="2">2</option>
                              <option value="3">3</option>
                              <option value="5">5</option>
                              <option value="7">7</option>
                              <option value="10">10</option>
                          </select>
                          <label>Points</label>
                      </div>  

                      <div class="row">
                        <a id="BTN_AddParticipants" class="waves-effect waves-light btn light-blue darken-1  AlignButtonRight hoverable" style="text-decoration: none;" onclick="Validate_Add_Empoyees_As_Participants()">Save</a>
                      </div>  
                  </div>
                </div>
              </div>
              <div class="col s8 ">
                <h6 class="light-blue-text" style="font-weight: 500 !important;font-size: 18px !important">PARTICIPANTS</h6>
                <div class="row card-panel">

                  <div class="input-field row">
 <!--                            <input id="TB_SearchParticipant" type="search" class="light-table-filter" data-table="order-table">
                            <label for="TB_SearchParticipant">Search</label> -->

                          <div class="input-field col s6 s12 red-text">
                            <i class="light-blue-text material-icons prefix">search</i>
                            <input type="text" placeholder="search" id="TB_SearchParticipant" type="search" class="light-table-filter" data-table="order-table" >
                          </div>

                  </div> 

                  <table id="Table_Participants" class="highlight order-table table">
                    <thead>
                      <tr>
                        <th>EMPLOYEE ID</th>
                        <th>NAME</th>
                        <th>DEPARTMENT</th>
                        <th>POINTS</th>
                      </tr>
                    </thead>
                  </table>
                </div>
              </div>
            </div>

          </div>
        </div>

        </div>


        <div class="col s12" id="Div_EmployeeView">
        	<div class="row card-panel " id="" >
        		  
              <div class="row">
                <div class="col s7">
                  <span class="card-title light-blue-text  " style="font-weight: 500; font-size: 24px !important">LEARNING & DEVELOPMENT ACTIVITIES</span>
                  <div class="card-panel">

                    <table id="Table_Activities_List" class="striped">
                      <thead>
                        <tr>
                          <!-- <th>VIEW PARTICIPANTS</th> -->
                          <th class="grey-text text-darken-2">DATE</th>
                          <th class="grey-text text-darken-2">TYPE</th>
                          <th class="grey-text text-darken-2">TOPIC/SUBJECT</th>
                          <th class="grey-text text-darken-2">DURATION</th>
                          <th class="grey-text text-darken-2">FACILITATOR</th>
                        </tr>
                      </thead>
                    </table>
                  </div>
                </div>
                <div class="col s5" >
                  <span class="card-title light-blue-text " style="font-weight: 500; font-size: 24px !important">ATTENDED</span>
                  <div class="row">
                    <div class="col s11">
                      <label class="AlignButtonRight grey-text text-darken-1" style="font-size: 18px !important;">TOTAL POINTS :</label>
                    </div>  
                    <div class="col s1">
                      <label class="AlignButtonLeft green-text " style="font-weight: 700 !important;font-size: 20px !important;" id="LBL_TotalPoints_Individual"></label>
                    </div>  
                  </div>
                  <div class="card-panel" id="Div_Employee_Activities_Attended">
                  </div>
                </div> 
              </div>
        	</div>
        </div>

    
</div>

</div>


            </div>
    </div>
</div>

</div>

</main>


<!-- ------------------------------------------------------------------------------------------------------------------- -->
  <!-- Dropdown Structure -->
  <ul id='UL_DropdownDepartment' class='dropdown-content' style="width: auto !important;">
 <!--  <li><a onclick='Department_Clicked(this)' id="ALL DEPARTMENTS" style="text-decoration: none;">ALL DEPARTMENTS</a></li> -->
  </ul>


<!-- ------------------------------------------------------------------------------------------------------------------- -->

<!-- MODAL ACTIVITY FORM -->
<div id="ModalNewEntry" class="modal ">
    <div id="ModalNewEntryContent" class="modal-content">
          <div class="row">
              <a class="btn-floating red AlignButtonRight" onclick="CloseNewEntry_Modal()"><i class=" material-icons">close</i></a>
          </div>

        <div class="row">
            <div class="col s4"></div>
            <div class="col s4">
                  <div class="card-panel z-depth-2">
                      <div class="input-field row">
                            <label>DATE</label>
                            <input type = "text" class = "datepicker" id="Date_ActivityDate" placeholder="">    
                      </div>                    
                      <div class="input-field row">
                            <input id="TB_Type" type="text" placeholder="">
                            <label for="TB_Type">TYPE</label>
                      </div>
                      <div class="input-field row">
                            <input id="TB_Topic" type="text" placeholder="">
                            <label for="TB_Topic">TOPIC / SUBJECT</label>
                      </div>   
                      <div class="input-field row">
                            <input id="TB_Duration" type="text" placeholder="">
                            <label for="TB_Duration">DURATION (HOURS)</label>
                      </div>    
                      <div class="input-field row">
                            <input id="TB_Facilitator" type="text" placeholder="">
                            <label for="TB_Facilitator">FACILITATOR</label>
                      </div>  
                
                      <div class="row">
                        <a class="waves-effect waves-light btn light-blue darken-1 AlignButtonRight hoverable" style="text-decoration: none;" onclick="Validate_ActivityForm()">Save</a>
                      </div>
                  </div>      
            </div>         
        </div>
    </div>
</div>

<!-- ------------------------------------------------------------------------------------------------------------------- -->


<div id="ModalPoints" class="modal ">
    <div id="ModalPointsContent" class="modal-content">
          <div class="row">
              <a class="btn-floating red AlignButtonRight" onclick="ClosePoints_Modal()"><i class=" material-icons">close</i></a>
          </div>

        <div class="row">
          <div class="col s6">

            <div class="card-panel" id="Div_EmployeeForPoints">

                <div class="center row">
                  <div class="col s12 " >
                      <div class="row" id="topbarsearch">
                          <div class="input-field col s6 s12 red-text">
                            <i class="light-blue-text material-icons prefix">search</i>
                            <input type="text" placeholder="search" type="search" class="EmpPoints-table-filter" data-table="order-table-EmpPoints" >
                          </div>
                      </div>
                  </div>
                </div>  

                  <table id="TBL_Points_Employees" class="highlight order-table-EmpPoints table bordered">
                    <thead>
                      <tr>
                        <th >EMPLOYEE ID</th>
                        <th>NAME</th>
                        <th>DEPARTMENT</th>
                      </tr>
                    </thead>
                  </table>
            </div>
          </div>
          <div class="col s6">
            <div class="row">
              <div class="col s10">
                <label class="AlignButtonRight grey-text text-darken-1" style="font-size: 18px !important;">TOTAL POINTS :</label>
              </div>  
              <div class="col s1">
                <label class="AlignButtonLeft green-text " style="font-weight: 700 !important;font-size: 20px !important;" id="LBL_TotalPoints"></label>
              </div>  
            </div>
            <div class="card-panel row" id="Div_AttendedActivities"></div>
          </div>
        </div>
    </div>
</div>

<!-- ------------------------------------------------------------------------------------------------------------------- -->


  <!--SCRIPT-->

    <script type = "text/javascript" src = "https://code.jquery.com/jquery-2.1.1.min.js"></script>
    <script src="https://intranet.houseofit.com.au/SiteAssets/Logo/MaterialDesign/js/materialize.min.js"></script>

    <script src="https://intranet.houseofit.com.au/SiteAssets/Logo/MaterialDesign/SweetAlert2/sweetalert2.js"></script>

<!-- CHARTS JS -->
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.1/Chart.bundle.js"></script>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.1/Chart.bundle.min.js"></script>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.1/Chart.js"></script>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.1/Chart.min.js"></script>

  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.20.1/moment.min.js"></script>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.20.1/moment.js"></script>

</body>

</html>

